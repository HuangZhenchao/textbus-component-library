//处理文件上传的方法
export function SetUploader(uploadFilePromise) {
    function uploader(config) {
        console.log('uploader');
        const fileInput = document.createElement('input');
        fileInput.setAttribute('type', 'file');
        fileInput.setAttribute('multiple', 'multiple'); //多选
        switch (config.uploadType) {
            case 'image':
                fileInput.setAttribute('accept', 'image/png, image/gif, image/jpeg, image/bmp, image/x-icon');
                break;
            case 'video':
                fileInput.setAttribute('accept', 'video/mp4');
                break;
            case 'audio':
                fileInput.setAttribute('accept', 'audio/ogg, audio/wav, audio/mpeg');
                break;
            default:
                fileInput.setAttribute('accept', '*');
        }
        fileInput.style.cssText = 'position: absolute; left: -9999px; top: -9999px; opacity: 0';
        const promise = new Promise(resolve => {
            fileInput.addEventListener('change', event => {
                const form = new FormData();
                const el = event.target;
                for (const file of el.files) {
                    //console.log('arrayBuffer',file.arrayBuffer())
                    form.append('file', file);
                }
                form.append('filename', 'file');
                console.log(typeof el.files, el.files);
                document.body.removeChild(fileInput);
                uploadFilePromise(form).then(response => {
                    let result = response.data.data;
                    resolve(result);
                });
            });
        });
        document.body.appendChild(fileInput);
        fileInput.click();
        return promise;
    }
    return uploader;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBsb2FkZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi90ZXh0YnVzL3V0aWxzL3VwbG9hZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFdBQVc7QUFDWCxNQUFNLFVBQVUsV0FBVyxDQUFDLGlCQUFpQjtJQUN6QyxTQUFTLFFBQVEsQ0FBQyxNQUFNO1FBQ3BCLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUE7UUFDdkIsTUFBTSxTQUFTLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNsRCxTQUFTLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUN2QyxTQUFTLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBQyxVQUFVLENBQUMsQ0FBQyxDQUFBLElBQUk7UUFDbEQsUUFBUSxNQUFNLENBQUMsVUFBVSxFQUFFO1lBQ3ZCLEtBQUssT0FBTztnQkFDUixTQUFTLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRSwyREFBMkQsQ0FBQyxDQUFDO2dCQUM5RixNQUFNO1lBQ1YsS0FBSyxPQUFPO2dCQUNSLFNBQVMsQ0FBQyxZQUFZLENBQUMsUUFBUSxFQUFFLFdBQVcsQ0FBQyxDQUFDO2dCQUM5QyxNQUFNO1lBQ1YsS0FBSyxPQUFPO2dCQUNSLFNBQVMsQ0FBQyxZQUFZLENBQUMsUUFBUSxFQUFFLGtDQUFrQyxDQUFDLENBQUM7Z0JBQ3JFLE1BQU07WUFDVjtnQkFDSSxTQUFTLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQztTQUM3QztRQUVELFNBQVMsQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLDZEQUE2RCxDQUFDO1FBQ3hGLE1BQU0sT0FBTyxHQUFJLElBQUksT0FBTyxDQUFTLE9BQU8sQ0FBQyxFQUFFO1lBQzNDLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLEVBQUU7Z0JBQ3pDLE1BQU0sSUFBSSxHQUFHLElBQUksUUFBUSxFQUFFLENBQUM7Z0JBQzVCLE1BQU0sRUFBRSxHQUFDLEtBQUssQ0FBQyxNQUEwQixDQUFDO2dCQUUxQyxLQUFLLE1BQU0sSUFBSSxJQUFJLEVBQUUsQ0FBQyxLQUFNLEVBQUU7b0JBQzFCLCtDQUErQztvQkFDL0MsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7aUJBQzdCO2dCQUNELElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFLE1BQU0sQ0FBQyxDQUFDO2dCQUNoQyxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDLEtBQUssRUFBQyxFQUFFLENBQUMsS0FBTSxDQUFDLENBQUE7Z0JBQ3RDLFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxDQUFDO2dCQUNyQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUU7b0JBQ3BDLElBQUksTUFBTSxHQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO29CQUM5QixPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ3BCLENBQUMsQ0FBQyxDQUFBO1lBRU4sQ0FBQyxDQUFDLENBQUE7UUFDTixDQUFDLENBQUMsQ0FBQTtRQUNGLFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3JDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNsQixPQUFPLE9BQU8sQ0FBQztJQUVuQixDQUFDO0lBQ0QsT0FBTyxRQUFRLENBQUM7QUFDcEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8v5aSE55CG5paH5Lu25LiK5Lyg55qE5pa55rOVXHJcbmV4cG9ydCBmdW5jdGlvbiBTZXRVcGxvYWRlcih1cGxvYWRGaWxlUHJvbWlzZSkge1xyXG4gICAgZnVuY3Rpb24gdXBsb2FkZXIoY29uZmlnKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ3VwbG9hZGVyJylcclxuICAgICAgICBjb25zdCBmaWxlSW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xyXG4gICAgICAgIGZpbGVJbnB1dC5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAnZmlsZScpO1xyXG4gICAgICAgIGZpbGVJbnB1dC5zZXRBdHRyaWJ1dGUoJ211bHRpcGxlJywnbXVsdGlwbGUnKTsvL+WkmumAiVxyXG4gICAgICAgIHN3aXRjaCAoY29uZmlnLnVwbG9hZFR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAnaW1hZ2UnOlxyXG4gICAgICAgICAgICAgICAgZmlsZUlucHV0LnNldEF0dHJpYnV0ZSgnYWNjZXB0JywgJ2ltYWdlL3BuZywgaW1hZ2UvZ2lmLCBpbWFnZS9qcGVnLCBpbWFnZS9ibXAsIGltYWdlL3gtaWNvbicpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ3ZpZGVvJzpcclxuICAgICAgICAgICAgICAgIGZpbGVJbnB1dC5zZXRBdHRyaWJ1dGUoJ2FjY2VwdCcsICd2aWRlby9tcDQnKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdhdWRpbyc6XHJcbiAgICAgICAgICAgICAgICBmaWxlSW5wdXQuc2V0QXR0cmlidXRlKCdhY2NlcHQnLCAnYXVkaW8vb2dnLCBhdWRpby93YXYsIGF1ZGlvL21wZWcnKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgZmlsZUlucHV0LnNldEF0dHJpYnV0ZSgnYWNjZXB0JywgJyonKTtcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICBmaWxlSW5wdXQuc3R5bGUuY3NzVGV4dCA9ICdwb3NpdGlvbjogYWJzb2x1dGU7IGxlZnQ6IC05OTk5cHg7IHRvcDogLTk5OTlweDsgb3BhY2l0eTogMCc7XHJcbiAgICAgICAgY29uc3QgcHJvbWlzZSA9ICBuZXcgUHJvbWlzZTxzdHJpbmc+KHJlc29sdmUgPT4ge1xyXG4gICAgICAgICAgICBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZXZlbnQgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZm9ybSA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZWw9ZXZlbnQudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQ7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZmlsZSBvZiBlbC5maWxlcyEpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdhcnJheUJ1ZmZlcicsZmlsZS5hcnJheUJ1ZmZlcigpKVxyXG4gICAgICAgICAgICAgICAgICAgIGZvcm0uYXBwZW5kKCdmaWxlJywgZmlsZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBmb3JtLmFwcGVuZCgnZmlsZW5hbWUnLCAnZmlsZScpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2codHlwZW9mIGVsLmZpbGVzLGVsLmZpbGVzISlcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZmlsZUlucHV0KTtcclxuICAgICAgICAgICAgICAgIHVwbG9hZEZpbGVQcm9taXNlKGZvcm0pLnRoZW4ocmVzcG9uc2UgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCByZXN1bHQ9cmVzcG9uc2UuZGF0YS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0KTsgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSlcclxuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGZpbGVJbnB1dCk7XHJcbiAgICAgICAgZmlsZUlucHV0LmNsaWNrKCk7XHJcbiAgICAgICAgcmV0dXJuIHByb21pc2U7XHJcbiAgICBcclxuICAgIH1cclxuICAgIHJldHVybiB1cGxvYWRlcjtcclxufSJdfQ==