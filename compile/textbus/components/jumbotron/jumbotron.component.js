import { ContentType, defineComponent, Slot, useContext, useSlots, useState, VElement, onContextMenu } from "@textbus/core";
import { Dialog, FileUploader, Form, FormTextField } from "@textbus/editor";
export class JumbotronSlot extends Slot {
    constructor() {
        super([ContentType.Text, ContentType.BlockComponent, ContentType.InlineComponent]);
    }
}
export const jumbotronComponent = defineComponent({
    name: "jumbotronComponent",
    type: ContentType.BlockComponent,
    setup(data) {
        const injector = useContext();
        const dialog = injector.get(Dialog);
        const fileUploader = injector.get(FileUploader);
        const slots = useSlots(data.slots || [new JumbotronSlot()]);
        let state = data.state;
        const changeController = useState(state);
        //useState({fill:false,type:'info',slot:slots.toJSON()})
        changeController.onChange.subscribe(newState => {
            state = newState;
            console.log('changeController', state);
        });
        const form = new Form({
            confirmBtnText: '确定',
            items: [
                new FormTextField({
                    name: 'minHeight',
                    value: state.minHeight,
                    placeholder: '',
                    label: '巨幕最小高度'
                }),
                new FormTextField({
                    label: '背景图片地址',
                    name: 'backgroundImage',
                    placeholder: '',
                    canUpload: true,
                    uploadType: 'image',
                    uploadBtnText: '上传',
                    value: state.backgroundImage,
                    fileUploader,
                    validateFn(value) {
                        if (!value) {
                            return 'test';
                        }
                        return false;
                    }
                })
            ]
        });
        form.onComplete.subscribe(map => {
            changeController.update(draft => {
                draft.minHeight = map.get('minHeight');
                draft.backgroundImage = map.get('backgroundImage');
            });
            dialog.hide();
        });
        form.onCancel.subscribe(() => {
            dialog.hide();
        });
        onContextMenu(() => {
            return [{
                    label: "巨幕设置",
                    onClick() {
                        dialog.show(form.elementRef);
                    }
                }];
        });
        return {
            render(isOutputMode, slotRender) {
                const vEle = VElement.createElement("div", {
                    class: 'tb-jumbotron',
                    style: {
                        backgroundImage: `url("${state.backgroundImage}")`,
                        backgroundSize: state.backgroundSize || 'cover',
                        backgroundPosition: state.backgroundPosition || 'center',
                        minHeight: state.minHeight
                    }
                });
                return slotRender(slots.get(0), () => { return vEle; });
            }
        };
    }
});
export const jumbotronComponentLoader = {
    component: jumbotronComponent,
    match(element) {
        return element.tagName.toLowerCase() === 'div' && element.className === 'tb-jumbotron';
    },
    read(element, context, slotParser) {
        const style = element.style;
        const state = {
            backgroundImage: (style.backgroundImage || '').replace(/^url\(['"]?|['"]?\)$/g, ''),
            backgroundSize: style.backgroundSize,
            backgroundPosition: style.backgroundPosition,
            minHeight: style.minHeight,
        };
        let slot = new JumbotronSlot();
        slotParser(slot, element);
        return jumbotronComponent.createInstance(context, { slots: [slot], state: state });
        //const component = new TodoListComponent(listConfig.map(i => i.slot));
    },
    resources: {
        styles: [
            `.tb-jumbotron {
                display: block;
                min-height: 200px;
                margin-bottom: 1em;
                background-color: #eee;
                padding: 20px;
              }
              `
        ]
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoianVtYm90cm9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3RleHRidXMvY29tcG9uZW50cy9qdW1ib3Ryb24vanVtYm90cm9uLmNvbXBvbmVudC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUdILFdBQVcsRUFDWCxlQUFlLEVBQUUsSUFBSSxFQUVyQixVQUFVLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQTBELGFBQWEsRUFDbEgsTUFBTSxlQUFlLENBQUM7QUFHdkIsT0FBTyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUF3QyxhQUFhLEVBQW9CLE1BQU0saUJBQWlCLENBQUM7QUFFcEksTUFBTSxPQUFPLGFBQWMsU0FBUSxJQUFJO0lBQ25DO1FBQ0ksS0FBSyxDQUFDLENBQUMsV0FBVyxDQUFDLElBQUksRUFBQyxXQUFXLENBQUMsY0FBYyxFQUFDLFdBQVcsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDO0lBRXJGLENBQUM7Q0FDSjtBQVNELE1BQU0sQ0FBQyxNQUFNLGtCQUFrQixHQUFDLGVBQWUsQ0FBa0M7SUFDN0UsSUFBSSxFQUFFLG9CQUFvQjtJQUMxQixJQUFJLEVBQUUsV0FBVyxDQUFDLGNBQWM7SUFFaEMsS0FBSyxDQUFDLElBQW1DO1FBQ3JDLE1BQU0sUUFBUSxHQUFHLFVBQVUsRUFBRSxDQUFDO1FBQzlCLE1BQU0sTUFBTSxHQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUE7UUFDakMsTUFBTSxZQUFZLEdBQUcsUUFBUSxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUVoRCxNQUFNLEtBQUssR0FBQyxRQUFRLENBQ2hCLElBQUksQ0FBQyxLQUFLLElBQUcsQ0FBQyxJQUFJLGFBQWEsRUFBRSxDQUFDLENBQ3JDLENBQUE7UUFDRCxJQUFJLEtBQUssR0FBQyxJQUFJLENBQUMsS0FBdUIsQ0FBQTtRQUN0QyxNQUFN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QUNsRCxTQUFTLEVBQUUsa0JBQWtCO0lBRTdCLEtBQUssQ0FBQyxPQUFvQjtRQUN0QixPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLEtBQUssS0FBSyxJQUFJLE9BQU8sQ0FBQyxTQUFTLEtBQUssY0FBYyxDQUFBO0lBQzFGLENBQUM7SUFDRCxJQUFJLENBQUMsT0FBb0IsRUFBRSxPQUFpQixFQUFFLFVBQXNCO1FBQ2hFLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUM7UUFDNUIsTUFBTSxLQUFLLEdBQWdCO1lBQ3ZCLGVBQWUsRUFBRSxDQUFDLEtBQUssQ0FBQyxlQUFlLElBQUksRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLHVCQUF1QixFQUFFLEVBQUUsQ0FBQztZQUNuRixjQUFjLEVBQUUsS0FBSyxDQUFDLGNBQWM7WUFDcEMsa0JBQWtCLEVBQUUsS0FBSyxDQUFDLGtCQUFrQjtZQUM1QyxTQUFTLEVBQUUsS0FBSyxDQUFDLFNBQVM7U0FFN0IsQ0FBQTtRQUNELElBQUksSUFBSSxHQUFDLElBQUksYUFBYSxFQUFFLENBQUE7UUFDNUIsVUFBVSxDQUFDLElBQUksRUFBQyxPQUFPLENBQUMsQ0FBQTtRQUN4QixPQUFPLGtCQUFrQixDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUMsRUFBQyxLQUFLLEVBQUMsQ0FBQyxJQUFJLENBQUMsRUFBQyxLQUFLLEVBQUMsS0FBSyxFQUFDLENBQUMsQ0FBQztRQUU3RSx1RUFBdUU7SUFFM0UsQ0FBQztJQUVELFNBQVMsRUFBRTtRQUNQLE1BQU0sRUFBRTtZQUNKOzs7Ozs7O2VBT0c7U0FDTjtLQUNKO0NBQ0osQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgICBDb21wb25lbnRJbnN0YW5jZSxcclxuICAgIENvbXBvbmVudE1ldGhvZHMsXHJcbiAgICBDb250ZW50VHlwZSxcclxuICAgIGRlZmluZUNvbXBvbmVudCwgU2xvdCwgU2xvdFJlbmRlcixcclxuICAgIFRyYW5zbGF0b3IsXHJcbiAgICB1c2VDb250ZXh0LCB1c2VTbG90cywgdXNlU3RhdGUsIFZFbGVtZW50LFNlbGVjdGlvbiwgQ29tcG9uZW50T3B0aW9ucywgU2xvdExpdGVyYWwsIENvbXBvbmVudERhdGEsIG9uQ29udGV4dE1lbnVcclxufSBmcm9tIFwiQHRleHRidXMvY29yZVwiO1xyXG5pbXBvcnQge0NvbXBvbmVudExvYWRlciwgU2xvdFBhcnNlcn0gZnJvbSBcIkB0ZXh0YnVzL2Jyb3dzZXJcIjtcclxuaW1wb3J0IHtJbmplY3Rvcn0gZnJvbSBcIkB0YW5iby9kaVwiO1xyXG5pbXBvcnQgeyBEaWFsb2csIEZpbGVVcGxvYWRlciwgRm9ybSwgRm9ybVNlbGVjdCwgRm9ybVN3aXRjaCwgRm9ybVRleHRhcmVhLCBGb3JtVGV4dEZpZWxkLCBoZWFkaW5nQ29tcG9uZW50IH0gZnJvbSBcIkB0ZXh0YnVzL2VkaXRvclwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEp1bWJvdHJvblNsb3QgZXh0ZW5kcyBTbG90e1xyXG4gICAgY29uc3RydWN0b3IoKXtcclxuICAgICAgICBzdXBlcihbQ29udGVudFR5cGUuVGV4dCxDb250ZW50VHlwZS5CbG9ja0NvbXBvbmVudCxDb250ZW50VHlwZS5JbmxpbmVDb21wb25lbnRdKTtcclxuICAgICAgICBcclxuICAgIH1cclxufVxyXG5leHBvcnQgaW50ZXJmYWNlIGp1bWJvdHJvblN0YXRle1xyXG4gICAgbWluSGVpZ2h0OiBzdHJpbmc7XHJcbiAgICBiYWNrZ3JvdW5kSW1hZ2U6IHN0cmluZztcclxuICAgIGJhY2tncm91bmRTaXplOiBzdHJpbmc7XHJcbiAgICBiYWNrZ3JvdW5kUG9zaXRpb246IHN0cmluZztcclxufVxyXG5cclxuXHJcbmV4cG9ydCBjb25zdCBqdW1ib3Ryb25Db21wb25lbnQ9ZGVmaW5lQ29tcG9uZW50PENvbXBvbmVudE1ldGhvZHMsanVtYm90cm9uU3RhdGU+KHtcclxuICAgIG5hbWU6IFwianVtYm90cm9uQ29tcG9uZW50XCIsXHJcbiAgICB0eXBlOiBDb250ZW50VHlwZS5CbG9ja0NvbXBvbmVudCxcclxuXHJcbiAgICBzZXR1cChkYXRhOiBDb21wb25lbnREYXRhPGp1bWJvdHJvblN0YXRlPik6IENvbXBvbmVudE1ldGhvZHMge1xyXG4gICAgICAgIGNvbnN0IGluamVjdG9yID0gdXNlQ29udGV4dCgpOyAgICAgICAgXHJcbiAgICAgICAgY29uc3QgZGlhbG9nPWluamVjdG9yLmdldChEaWFsb2cpXHJcbiAgICAgICAgY29uc3QgZmlsZVVwbG9hZGVyID0gaW5qZWN0b3IuZ2V0KEZpbGVVcGxvYWRlcik7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3Qgc2xvdHM9dXNlU2xvdHMoXHJcbiAgICAgICAgICAgIGRhdGEuc2xvdHMgfHxbbmV3IEp1bWJvdHJvblNsb3QoKV0sICAgICAgICAgICAgIFxyXG4gICAgICAgIClcclxuICAgICAgICBsZXQgc3RhdGU9ZGF0YS5zdGF0ZSBhcyBqdW1ib3Ryb25TdGF0ZVxyXG4gICAgICAgIGNvbnN0IGNoYW5nZUNvbnRyb2xsZXI9dXNlU3RhdGUoc3RhdGUpO1xyXG4gICAgICAgIC8vdXNlU3RhdGUoe2ZpbGw6ZmFsc2UsdHlwZTonaW5mbycsc2xvdDpzbG90cy50b0pTT04oKX0pXHJcbiAgICAgICAgY2hhbmdlQ29udHJvbGxlci5vbkNoYW5nZS5zdWJzY3JpYmUobmV3U3RhdGU9PntcclxuICAgICAgICAgICAgc3RhdGU9bmV3U3RhdGU7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjaGFuZ2VDb250cm9sbGVyJyxzdGF0ZSlcclxuICAgICAgICB9KVxyXG4gICAgICAgIGNvbnN0IGZvcm0gPSBuZXcgRm9ybSh7XHJcbiAgICAgICAgICAgIGNvbmZpcm1CdG5UZXh0OiAn56Gu5a6aJyxcclxuICAgICAgICAgICAgaXRlbXM6IFtcclxuICAgICAgICAgICAgICAgIG5ldyBGb3JtVGV4dEZpZWxkKHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnbWluSGVpZ2h0JyxcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogc3RhdGUubWluSGVpZ2h0LFxyXG4gICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICBsYWJlbDogJ+W3qOW5leacgOWwj+mrmOW6pidcclxuICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAgICAgbmV3IEZvcm1UZXh0RmllbGQoe1xyXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiAn6IOM5pmv5Zu+54mH5Zyw5Z2AJyxcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnYmFja2dyb3VuZEltYWdlJyxcclxuICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgY2FuVXBsb2FkOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZFR5cGU6ICdpbWFnZScsXHJcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkQnRuVGV4dDogJ+S4iuS8oCcsXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHN0YXRlLmJhY2tncm91bmRJbWFnZSxcclxuICAgICAgICAgICAgICAgICAgICBmaWxlVXBsb2FkZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGVGbih2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ3Rlc3QnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICBdXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgZm9ybS5vbkNvbXBsZXRlLnN1YnNjcmliZShtYXAgPT4ge1xyXG4gICAgICAgICAgICBjaGFuZ2VDb250cm9sbGVyLnVwZGF0ZShkcmFmdD0+e1xyXG4gICAgICAgICAgICAgICAgZHJhZnQubWluSGVpZ2h0ID0gbWFwLmdldCgnbWluSGVpZ2h0Jyk7XHJcbiAgICAgICAgICAgICAgICBkcmFmdC5iYWNrZ3JvdW5kSW1hZ2UgPSBtYXAuZ2V0KCdiYWNrZ3JvdW5kSW1hZ2UnKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgZGlhbG9nLmhpZGUoKVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGZvcm0ub25DYW5jZWwuc3Vic2NyaWJlKCgpPT57XHJcbiAgICAgICAgICAgIGRpYWxvZy5oaWRlKClcclxuICAgICAgICB9KVxyXG4gICAgICAgIG9uQ29udGV4dE1lbnUoKCk9PntcclxuICAgICAgICAgICAgcmV0dXJuIFt7XHJcbiAgICAgICAgICAgICAgICBsYWJlbDpcIuW3qOW5leiuvue9rlwiLFxyXG4gICAgICAgICAgICAgICAgb25DbGljaygpe1xyXG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZy5zaG93KGZvcm0uZWxlbWVudFJlZilcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfV1cclxuICAgICAgICB9KVxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlbmRlcihpc091dHB1dE1vZGU6Ym9vbGVhbiwgc2xvdFJlbmRlcjpTbG90UmVuZGVyKXtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCB2RWxlID0gVkVsZW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IFxyXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzOid0Yi1qdW1ib3Ryb24nLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZTogYHVybChcIiR7c3RhdGUuYmFja2dyb3VuZEltYWdlfVwiKWAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRTaXplOiBzdGF0ZS5iYWNrZ3JvdW5kU2l6ZSB8fCAnY292ZXInLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kUG9zaXRpb246IHN0YXRlLmJhY2tncm91bmRQb3NpdGlvbiB8fCAnY2VudGVyJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWluSGVpZ2h0OiBzdGF0ZS5taW5IZWlnaHRcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzbG90UmVuZGVyKHNsb3RzLmdldCgwKSEsICgpPT57cmV0dXJuIHZFbGV9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59KVxyXG5cclxuZXhwb3J0IGNvbnN0IGp1bWJvdHJvbkNvbXBvbmVudExvYWRlcjpDb21wb25lbnRMb2FkZXI9e1xyXG4gICAgY29tcG9uZW50OiBqdW1ib3Ryb25Db21wb25lbnQsXHJcblxyXG4gICAgbWF0Y2goZWxlbWVudDogSFRNTEVsZW1lbnQpIHtcclxuICAgICAgICByZXR1cm4gZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdkaXYnICYmIGVsZW1lbnQuY2xhc3NOYW1lID09PSAndGItanVtYm90cm9uJ1xyXG4gICAgfSxcclxuICAgIHJlYWQoZWxlbWVudDogSFRNTEVsZW1lbnQsIGNvbnRleHQ6IEluamVjdG9yLCBzbG90UGFyc2VyOiBTbG90UGFyc2VyKSA6Q29tcG9uZW50SW5zdGFuY2V7XHJcbiAgICAgICAgY29uc3Qgc3R5bGUgPSBlbGVtZW50LnN0eWxlO1xyXG4gICAgICAgIGNvbnN0IHN0YXRlOmp1bWJvdHJvblN0YXRlPXtcclxuICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlOiAoc3R5bGUuYmFja2dyb3VuZEltYWdlIHx8ICcnKS5yZXBsYWNlKC9edXJsXFwoWydcIl0/fFsnXCJdP1xcKSQvZywgJycpLFxyXG4gICAgICAgICAgICBiYWNrZ3JvdW5kU2l6ZTogc3R5bGUuYmFja2dyb3VuZFNpemUsXHJcbiAgICAgICAgICAgIGJhY2tncm91bmRQb3NpdGlvbjogc3R5bGUuYmFja2dyb3VuZFBvc2l0aW9uLFxyXG4gICAgICAgICAgICBtaW5IZWlnaHQ6IHN0eWxlLm1pbkhlaWdodCxcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBzbG90PW5ldyBKdW1ib3Ryb25TbG90KClcclxuICAgICAgICBzbG90UGFyc2VyKHNsb3QsZWxlbWVudClcclxuICAgICAgICByZXR1cm4ganVtYm90cm9uQ29tcG9uZW50LmNyZWF0ZUluc3RhbmNlKGNvbnRleHQse3Nsb3RzOltzbG90XSxzdGF0ZTpzdGF0ZX0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vY29uc3QgY29tcG9uZW50ID0gbmV3IFRvZG9MaXN0Q29tcG9uZW50KGxpc3RDb25maWcubWFwKGkgPT4gaS5zbG90KSk7XHJcbiAgICAgICAgXHJcbiAgICB9LFxyXG4gICAgXHJcbiAgICByZXNvdXJjZXM6IHtcclxuICAgICAgICBzdHlsZXM6IFtcclxuICAgICAgICAgICAgYC50Yi1qdW1ib3Ryb24ge1xyXG4gICAgICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7XHJcbiAgICAgICAgICAgICAgICBtaW4taGVpZ2h0OiAyMDBweDtcclxuICAgICAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDFlbTtcclxuICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNlZWU7XHJcbiAgICAgICAgICAgICAgICBwYWRkaW5nOiAyMHB4O1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBgXHJcbiAgICAgICAgXVxyXG4gICAgfSxcclxufSJdfQ==